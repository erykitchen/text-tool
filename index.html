<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>キャラ設定ジェネレーター Pro</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; color: #333; }
        .card { background: white; padding: 25px; border-radius: 12px; shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; text-align: center; }
        .setting-row { margin-bottom: 15px; display: flex; align-items: center; flex-wrap: wrap; }
        .setting-row label { width: 180px; font-weight: bold; }
        input[type="text"], input[type="password"], select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex: 1; min-width: 200px; }
        .radio-group { display: flex; gap: 15px; }
        button { background: #1a73e8; color: white; border: none; padding: 12px 25px; cursor: pointer; border-radius: 6px; font-size: 16px; width: 100%; transition: 0.3s; }
        button:hover { background: #1557b0; }
        button:disabled { background: #ccc; }
        #output { white-space: pre-wrap; background: #282c34; color: #abb2bf; padding: 20px; border-radius: 8px; font-family: monospace; line-height: 1.6; min-height: 200px; margin-top: 20px; }
        .status { text-align: center; margin-top: 10px; font-weight: bold; color: #1a73e8; }
    </style>
</head>
<body>

<h1>Character Generator Pro</h1>

<div class="card">
    <div class="setting-row">
        <label>1. OpenAI API Key</label>
        <input type="password" id="apiKey" placeholder="sk-...">
    </div>

    <div class="setting-row">
        <label>2. お手本ファイル (.txt)</label>
        <input type="file" id="fileInput" accept=".txt">
    </div>

    <div class="setting-row">
        <label>3. 生成テーマ</label>
        <input type="text" id="theme" placeholder="例：地雷系の女子大生、厳しい女上司">
    </div>

    <div class="setting-row">
        <label>4. 口調の選択</label>
        <div class="radio-group">
            <label><input type="radio" name="tone" value="タメ語" checked> タメ語</label>
            <label><input type="radio" name="tone" value="丁寧な敬語"> 敬語</label>
        </div>
    </div>

    <div class="setting-row">
        <label>5. 絵文字</label>
        <div class="radio-group">
            <label><input type="radio" name="emoji" value="適宜使用する" checked> あり</label>
            <label><input type="radio" name="emoji" value="一切使用しない"> なし</label>
        </div>
    </div>

    <button onclick="generate()" id="genBtn">新規キャラクターを生成</button>
    <div id="status" class="status"></div>
</div>

<div class="card">
    <h3>生成結果</h3>
    <div id="output">お手本を読み込み、生成ボタンを押してください。</div>
</div>

<script>
    let templateContent = "";

    // ファイル読み込み処理
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            templateContent = e.target.result;
            document.getElementById('status').innerText = "お手本ファイルを読み込みました ✅";
        };
        reader.readAsText(file);
    });

    async function generate() {
        const apiKey = document.getElementById('apiKey').value;
        const theme = document.getElementById('theme').value || "新しいキャラクター";
        const tone = document.querySelector('input[name="tone"]:checked').value;
        const emoji = document.querySelector('input[name="emoji"]:checked').value;
        const btn = document.getElementById('genBtn');
        const output = document.getElementById('output');
        const status = document.getElementById('status');

        if (!apiKey) { alert("APIキーを入力してください"); return; }
        if (!templateContent) { alert("お手本となるテキストファイルをアップロードしてください"); return; }

        btn.disabled = true;
        status.innerText = "AIが思考中...（約30秒ほどかかります）";
        output.innerText = "生成中...";

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-4o", // 最新の高精度モデルを使用
                    messages: [
                        {
                            role: "system",
                            content: `あなたはプロのシナリオライターです。ユーザーから渡されるテキストファイルのフォーマット（項目名や区切り線）を100%忠実に守り、新しいキャラクター設定を生成してください。`
                        },
                        {
                            role: "user",
                            content: `
以下の条件で、新しいキャラクターを1人生成してください。

■条件：
1. テーマ: ${theme}
2. 口調: ${tone}
3. 絵文字: ${emoji}

■守るべきフォーマット（お手本）:
${templateContent}

※注意:
・「■キャラ名」「■アタック」「■返信」などの項目名は必ず維持してください。
・指示された「口調」と「絵文字の有無」を、アタックや返信のセリフすべてに反映させてください。
`
                        }
                    ],
                    temperature: 0.7
                })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            
            output.innerText = data.choices[0].message.content;
            status.innerText = "生成完了！ ✨";
        } catch (error) {
            output.innerText = "エラーが発生しました:\n" + error.message;
            status.innerText = "エラー終了 ❌";
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>